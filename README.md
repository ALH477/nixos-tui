# nixos-tui

A zero-dependency terminal UI for generating `configuration.nix` — written in TypeScript and running on [Bun](https://bun.sh).

```
  ███╗   ██╗██╗██╗  ██╗ ██████╗ ███████╗
  ████╗  ██║██║╚██╗██╔╝██╔═══██╗██╔════╝
  ██╔██╗ ██║██║ ╚███╔╝ ██║   ██║███████╗
  ██║╚██╗██║██║ ██╔██╗ ██║   ██║╚════██║
  ██║ ╚████║██║██╔╝ ██╗╚██████╔╝███████║
  ╚═╝  ╚═══╝╚═╝╚═╝  ╚═╝ ╚═════╝ ╚══════╝
```

## Features

- **6 settings sections** — User, System, Desktop, Network, Security, Packages (35+ options)
- **6 interactive tutorials** — First Boot → Flakes → Home Manager → Nix Store → Secrets → Debugging
- **Live config preview** — syntax-highlighted `configuration.nix` with one-key save to `/tmp/`
- **Sierpinski fractal** on the home screen whose recursion depth scales with your CPU thread count (more cores → deeper triangle)
- **Modified indicators** — `◈` marks every changed setting; section badges show counts
- **Inline editing** — cursor-based editor for string/number fields with validation
- **Zero runtime dependencies** — pure ANSI escape codes, no ncurses, no npm packages

## Requirements

| Tool | Version |
|------|---------|
| [Bun](https://bun.sh) | ≥ 1.0 |
| Terminal | 80×24 minimum, true-colour recommended |

## Quick start

```bash
git clone https://github.com/you/nixos-tui
cd nixos-tui
bun run src/main.ts
```

Or with file watching during development:

```bash
bun --watch run src/main.ts
```

## Key bindings

### Global

| Key | Action |
|-----|--------|
| `s` | Settings |
| `t` | Tutorials |
| `e` | Export / preview config |
| `q` / `Esc` | Back / quit |
| `?` | Toggle help overlay |
| `Ctrl+C` | Quit from anywhere |

### Settings

| Key | Action |
|-----|--------|
| `↑↓` / `j` `k` | Navigate items |
| `←→` / `h` `l` | Cycle enum · ±1 number · toggle bool |
| `Tab` | Switch focus: nav pane ↔ content pane |
| `Enter` | Edit string/number · toggle bool |
| `Space` | Toggle bool · cycle enum forward |
| `R` | Reset current section to defaults |

### Export

| Key | Action |
|-----|--------|
| `↑↓` | Scroll line by line |
| `PgUp` / `PgDn` | Scroll page |
| `g` / `G` | Jump to top / bottom |
| `W` | Save to `/tmp/configuration.nix` |
| `Tab` | Jump to Settings |

### Tutorials

| Key | Action |
|-----|--------|
| `↑↓` | Select tutorial |
| `Enter` / `→` | Open / next step |
| `←` | Previous step |
| `Esc` | Back to list |

## Sierpinski fractal

The home screen shows a Sierpinski triangle whose **recursion depth is driven by your CPU thread count**:

| Logical threads | Depth | Terminal rows | Width |
|----------------|-------|--------------|-------|
| 1–4 | 2 | 2 | 7 |
| 5–8 | 3 | 4 | 15 |
| 9–16 | 4 | 8 | 31 |
| 17–32 | 5 | 16 | 63 |
| 33–64 | 6 | 32 | 127 |

Rendered with Unicode half-block characters (`▀ ▄`) for 2× vertical resolution. Each terminal row encodes two logical pixel rows independently coloured via foreground/background, producing a blue→green→amber gradient from apex to base.

The depth label below the triangle (`depth 4  ·  12 logical threads`) makes the hardware-to-visual mapping explicit.

## Generated config

The Export screen generates a `configuration.nix` that reflects all your settings:

```nix
# Auto-generated by NixOS TUI v3
# ⚠  Review before applying — this is a starting point, not a complete config
{ config, pkgs, lib, ... }:
{
  users.users.alice = {
    isNormalUser  = true;
    shell         = pkgs.zsh;
    extraGroups   = [ "wheel" "networkmanager" "audio" "video" ];
    initialPassword = "changeme"; # CHANGE after first login
  };

  networking.hostName = "mymachine";
  time.timeZone       = "America/New_York";
  # ... etc
}
```

Press `W` from the Export screen to save to `/tmp/configuration.nix`, review it, then:

```bash
sudo cp /tmp/configuration.nix /etc/nixos/configuration.nix
sudo nixos-rebuild switch
```

## Project structure

```
nixos-tui/
├── src/
│   └── main.ts          # entire application (~1800 lines, zero deps)
├── package.json
├── tsconfig.json
├── .gitignore
└── README.md
```

The application is intentionally a single file. The section order in `main.ts` follows the data flow:

1. **System info** — `getLogicalThreads()`
2. **ANSI primitives** — `T`, escape sequences
3. **Palette** — `P`, colour constants
4. **Box drawing** — `B`, Unicode chars
5. **Helpers** — `visLen`, `padStr`, `clip`, `box`
6. **Sierpinski** — depth mapping, fill predicate, colour gradient, renderer
7. **Data** — `SETTINGS`, `TUTORIALS` (all static content)
8. **State** — `AppState`, `mkDefaults`, `invalidateConfig`, `setStatus`
9. **Rendering** — one function per screen
10. **Config generation** — `generateConfig`, `getConfig` (cached)
11. **Input** — `handleKey`, `adjustSetting`, `toggleBool`, `beginEdit`, `commitEdit`, `saveConfig`
12. **Lifecycle** — `cleanup`, `main`

## NixOS option accuracy

Config generation targets current NixOS stable (24.11) / unstable:

- `greetd` → `services.greetd.enable` (not `xserver.displayManager`)
- `hyprland` / `sway` / `river` → `programs.*.enable` (not `windowManager`)
- `nix.optimise.automatic` (not the deprecated `auto-optimise-store` key)
- `nix.settings` block only emitted when flakes or cachix are enabled
- `user.homeManager` toggle emits commented-out HM wiring block
- `desktop.wayland` sets `defaultSession` for plasma6/gnome appropriately

> **Note:** The generated file is a starting point. Always review before applying, especially `initialPassword`, `stateVersion`, and hardware-specific options.

## License

MIT
